[workspace]
name = "cpp-bleeding-edge"
version = "2026.1.0"
description = "Bleeding edge C++ dev environment (GCC 15.2 / LLVM 21)"
platforms = ["linux-64", "osx-arm64"]
channels = ["conda-forge"]

[dependencies]
cmake = "*"
ninja = "*"
python = "3.12.*"
sccache = "*"

# --- Feature: Automation (Zero Tolerance Suite) ---
[feature.automation.dependencies]
# Python SDKs
boto3 = "*"
docker-py = "*"
rich = "*"

# Static Analysis & Linters
ruff = "*"
vulture = "*"
deptry = "*"
taplo = "*"
yamllint = "*"
check-jsonschema = "*"
actionlint = "*"
typos = "*"
checkov = "*"
pytest = "*"
pytest-cov = "*"
pytest-testinfra = "*"

[feature.automation.pypi-dependencies]
ty = "*"
zizmor = "*"

# --- Feature: GCC 15.2 ---
[feature.gcc15.dependencies]
gcc = "*"
gxx = "*"

# --- Feature: LLVM 21 ---
[feature.llvm21.dependencies]
clang = "*"
clangxx = "*"
lld = "*"
lldb = "*"
clang-tools = "*"
llvm-tools = "*"

# --- Feature: Dev Tools ---
[feature.dev.dependencies]
gdb = "*"
starship = "*"
bat = "*"
ripgrep = "*"
direnv = "*"

# --- Environments ---
[environments]
automation = ["automation"]
stable = ["gcc15", "llvm21"]
dev-container = ["gcc15", "llvm21", "dev", "automation"]

[tasks]
validate = { cmd = "python -m scripts.validate", env = { PYTHONUNBUFFERED = "1" } }
build = { cmd = "python -m scripts.build", env = { PYTHONUNBUFFERED = "1" } }
setup-dev = { cmd = "python -m scripts.setup_dev", env = { PYTHONUNBUFFERED = "1" } }
init-container = "python -m scripts.lib.container_init"
prepush = { cmd = "python -m scripts.prepush", env = { PYTHONUNBUFFERED = "1" }, description = "Ensure clean git tree, run all linters/tests, and dry-run docker bake" }
